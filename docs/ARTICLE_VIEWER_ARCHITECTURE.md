# Архитектура модуля просмотрщика статей

## Обзор системы

Модуль просмотрщика статей представляет собой комплексную систему для отображения научных статей в формате Markdown с поддержкой математических формул, содержания, пагинации и навигации.

---

## Иерархия компонентов

```
┌─────────────────────────────────────────────────────────────────┐
│                    Пользовательский интерфейс                     │
│  ┌──────────────────────────┐  ┌─────────────────────────────┐ │
│  │   pages/articles.html    │  │  pages/article-view.html    │ │
│  │   (Каталог статей)       │  │  (Просмотр статьи)          │ │
│  └──────────────────────────┘  └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                            │                    │
                            ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    JavaScript модули                            │
│  ┌──────────────────────────┐  ┌─────────────────────────────┐ │
│  │ ArticlesCatalog          │  │ Article Viewer Script       │ │
│  │ (js/articles-catalog.js) │  │ (встроен в article-view.html)│ │
│  │                          │  │                              │ │
│  │ • init()                 │  │ • loadArticle()             │ │
│  │ • renderCatalog()        │  │ • simpleMarkdownToHtml()    │ │
│  │ • navigateToDirectory()  │  │ • paginateArticle()         │ │
│  │ • openArticle()          │  │ • generateTOC()              │ │
│  └──────────────────────────┘  └─────────────────────────────┘ │
│                                 │                                │
│                                 ▼                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ TableOfContents                                           │  │
│  │ (js/table-of-contents.js)                                │  │
│  │                                                           │  │
│  │ • generate()                                             │  │
│  │ • extractHeadings()                                      │  │
│  │ • renderToc()                                            │  │
│  │ • initScrollTracking()                                   │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Источники данных                              │
│  ┌──────────────────────────┐  ┌─────────────────────────────┐ │
│  │ articles/articles-list.  │  │ articles/{id}/article.md     │ │
│  │ json                      │  │ (Markdown + YAML frontmatter)│ │
│  │ (Каталог статей)          │  │                              │ │
│  └──────────────────────────┘  └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Внешние зависимости                           │
│  ┌──────────────────────────┐  ┌─────────────────────────────┐ │
│  │ MathJax                 │  │ Router (router.js)           │ │
│  │ (Рендеринг формул)       │  │ (SPA навигация)              │ │
│  └──────────────────────────┘  └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## Детальная иерархия компонентов

### 1. Уровень представления (Presentation Layer)

```
┌─────────────────────────────────────────────────────────────┐
│                    pages/articles.html                        │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ <div id="articles-list">                              │   │
│  │   <!-- Каталог статей (директории и статьи) -->      │   │
│  │   ┌──────────────────────────────────────────────┐   │   │
│  │   │ Breadcrumbs (хлебные крошки)                 │   │   │
│  │   └──────────────────────────────────────────────┘   │   │
│  │   ┌──────────────────────────────────────────────┐   │   │
│  │   │ Директории (directory-card)                  │   │   │
│  │   └──────────────────────────────────────────────┘   │   │
│  │   ┌──────────────────────────────────────────────┐   │   │
│  │   │ Статьи (article-card)                        │   │   │
│  │   └──────────────────────────────────────────────┘   │   │
│  │ </div>                                               │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    pages/article-view.html                    │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ <div id="article-content">                           │   │
│  │   ┌──────────────────────────────────────────────┐   │   │
│  │   │ <header> (метаданные статьи)                 │   │   │
│  │   └──────────────────────────────────────────────┘   │   │
│  │   ┌──────────────────────────────────────────────┐   │   │
│  │   │ <div id="article-body">                      │   │   │
│  │   │   ┌──────────────────────────────────────┐   │   │   │
│  │   │   │ .article-page (страница 1)          │   │   │   │
│  │   │   │   • Содержание (TOC)                │   │   │   │
│  │   │   │   • Контент раздела                 │   │   │   │
│  │   │   └──────────────────────────────────────┘   │   │   │
│  │   │   ┌──────────────────────────────────────┐   │   │   │
│  │   │   │ .article-page (страница 2-N)        │   │   │   │
│  │   │   │   • Контент раздела                 │   │   │   │
│  │   │   └──────────────────────────────────────┘   │   │   │
│  │   │   ┌──────────────────────────────────────┐   │   │   │
│  │   │   │ .article-pagination (навигация)      │   │   │   │
│  │   │   └──────────────────────────────────────┘   │   │   │
│  │   └──────────────────────────────────────────────┘   │   │
│  │ </div>                                               │   │
│  │ ┌──────────────────────────────────────────────┐     │   │
│  │ │ .article-scroll-buttons (плавающие кнопки)   │     │   │
│  │ └──────────────────────────────────────────────┘     │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 2. Уровень логики (Logic Layer)

```
┌─────────────────────────────────────────────────────────────┐
│                    ArticlesCatalog Class                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ constructor(config)                                   │   │
│  │   • basePath                                          │   │
│  │   • listContainerId                                   │   │
│  │   • configPath                                         │   │
│  │                                                        │   │
│  │ init()                                                │   │
│  │   ├─► fetch(articles-list.json)                       │   │
│  │   └─► renderCatalog()                                 │   │
│  │                                                        │   │
│  │ renderCatalog()                                       │   │
│  │   ├─► getCurrentDirectory()                          │   │
│  │   ├─► renderBreadcrumbs()                             │   │
│  │   ├─► renderDirectoryItem() (для каждой директории)   │   │
│  │   ├─► renderArticleItem() (для каждой статьи)         │   │
│  │   └─► attachEventListeners()                          │   │
│  │                                                        │   │
│  │ navigateToDirectory(dirId)                            │   │
│  │   └─► renderCatalog()                                 │   │
│  │                                                        │   │
│  │ openArticle(articleId)                                │   │
│  │   └─► router.navigate('/article?id=' + articleId)     │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Article Viewer Script                      │
│  (встроен в pages/article-view.html)                         │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ getArticleId()                                        │   │
│  │   ├─► window.location.search                          │   │
│  │   ├─► window.router.currentRoute                      │   │
│  │   └─► window.location.href                            │   │
│  │                                                        │   │
│  │ loadArticle(articleId)                                │   │
│  │   ├─► fetch(articles-list.json)                       │   │
│  │   ├─► findArticle() (рекурсивный поиск)               │   │
│  │   ├─► fetchArticleFile() (с fallback на GitHub Raw)   │   │
│  │   ├─► extractFrontmatter() (YAML парсинг)            │   │
│  │   ├─► simpleMarkdownToHtml() (конвертация)             │   │
│  │   ├─► generateTOC() (содержание)                      │   │
│  │   ├─► paginateArticle() (разбивка на страницы)        │   │
│  │   ├─► addIdsToHeadings() (якоря для заголовков)       │   │
│  │   ├─► initTocInteractivity() (интерактивность TOC)  │   │
│  │   └─► MathJax.typesetPromise() (рендеринг формул)      │   │
│  │                                                        │   │
│  │ simpleMarkdownToHtml(md)                              │   │
│  │   ├─► Обработка блоков кода (```)                     │   │
│  │   ├─► Обработка LaTeX формул ($$, $)                   │   │
│  │   ├─► Обработка формул ([formula])                     │   │
│  │   ├─► Обработка заголовков (#)                         │   │
│  │   ├─► Обработка таблиц (|)                             │   │
│  │   ├─► Обработка списков (-, *)                          │   │
│  │   ├─► Обработка ссылок ([])                             │   │
│  │   └─► Обработка изображений (![])                      │   │
│  │                                                        │   │
│  │ paginateArticle(html, tocHtml, articleId)             │   │
│  │   ├─► Поиск всех h2 заголовков                         │   │
│  │   ├─► Разбивка контента по разделам                    │   │
│  │   ├─► Генерация .article-page для каждого раздела      │   │
│  │   ├─► Добавление TOC на первую страницу                │   │
│  │   └─► generatePagination() (навигация)                 │   │
│  │                                                        │   │
│  │ initTocInteractivity()                                 │   │
│  │   ├─► initTocLinks() (клики по ссылкам)               │   │
│  │   └─► initTocScrollTracking() (отслеживание скролла)  │   │
│  │                                                        │   │
│  │ initScrollButtons()                                    │   │
│  │   ├─► Кнопка "Наверх"                                  │   │
│  │   ├─► Кнопка "Вниз"                                    │   │
│  │   ├─► Кнопка "Предыдущая страница"                     │   │
│  │   ├─► Кнопка "Следующая страница"                      │   │
│  │   └─► Кнопка "Домой" (к содержанию)                    │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    TableOfContents Class                     │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ constructor(config)                                   │   │
│  │   • minHeadings                                       │   │
│  │   • maxLevel                                          │   │
│  │   • scrollOffset                                      │   │
│  │                                                        │   │
│  │ generate(content)                                     │   │
│  │   ├─► extractHeadings()                              │   │
│  │   └─► renderToc()                                     │   │
│  │                                                        │   │
│  │ extractHeadings(element)                              │   │
│  │   ├─► querySelectorAll('h1-h6')                      │   │
│  │   ├─► generateId() (для каждого заголовка)            │   │
│  │   └─► Возврат массива {level, text, id, element}      │   │
│  │                                                        │   │
│  │ renderToc(headings)                                   │   │
│  │   ├─► Создание вложенной структуры <ul>/<li>          │   │
│  │   ├─► Генерация ссылок с data-toc-target              │   │
│  │   └─► Возврат HTML строки                             │   │
│  │                                                        │   │
│  │ initScrollTracking()                                  │   │
│  │   ├─► window.addEventListener('scroll')               │   │
│  │   ├─► updateActiveHeading()                           │   │
│  │   └─► setActiveLink()                                 │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 3. Уровень данных (Data Layer)

```
┌─────────────────────────────────────────────────────────────┐
│                    articles/articles-list.json               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ {                                                      │   │
│  │   "categories": [                                     │   │
│  │     {                                                 │   │
│  │       "id": "category-id",                            │   │
│  │       "title": "Название категории",                  │   │
│  │       "description": "Описание",                     │   │
│  │       "order": 1,                                     │   │
│  │       "items": [                                     │   │
│  │         {                                             │   │
│  │           "id": "article-id",                         │   │
│  │           "title": "Название статьи",                 │   │
│  │           "mdFile": "articles/article-id/article.md" │   │
│  │         },                                            │   │
│  │         {                                             │   │
│  │           "id": "subcategory-id",                     │   │
│  │           "title": "Подкатегория",                    │   │
│  │           "items": [...]                              │   │
│  │         }                                             │   │
│  │       ]                                               │   │
│  │     }                                                 │   │
│  │   ]                                                   │   │
│  │ }                                                      │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    articles/{id}/article.md                  │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ ---                                                    │   │
│  │ id: article-id                                        │   │
│  │ title: Название статьи                                │   │
│  │ author: Автор                                         │   │
│  │ date: 2025-01-01                                      │   │
│  │ category: Категория                                   │   │
│  │ tags: [тег1, тег2]                                     │   │
│  │ description: Описание                                 │   │
│  │ readingTime: 10                                       │   │
│  │ ---                                                    │   │
│  │                                                        │   │
│  │ # Заголовок статьи                                    │   │
│  │                                                        │   │
│  │ ## 📑 Содержание                                      │   │
│  │                                                        │   │
│  │ - [Раздел 1](#раздел-1)                               │   │
│  │ - [Раздел 2](#раздел-2)                               │   │
│  │                                                        │   │
│  │ ---                                                    │   │
│  │                                                        │   │
│  │ ## Раздел 1                                           │   │
│  │                                                        │   │
│  │ Текст статьи с формулами:                             │   │
│  │                                                        │   │
│  │ $$E = mc^2$$                                          │   │
│  │                                                        │   │
│  │ Или inline: $E = mc^2$                                │   │
│  │                                                        │   │
│  │ [formula:border]                                      │   │
│  │ E = mc^2                                              │   │
│  │ [/formula]                                            │   │
│  │                                                        │   │
│  │ ## Раздел 2                                           │   │
│  │                                                        │   │
│  │ ...                                                   │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## Поток данных (Data Flow)

### Сценарий 1: Просмотр каталога статей

```
Пользователь
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 1. Открывает /articles                                       │
│    └─► pages/articles.html загружается                      │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. ArticlesCatalog.init()                                    │
│    ├─► fetch('/articles/articles-list.json')                │
│    └─► catalogData = await response.json()                   │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. ArticlesCatalog.renderCatalog()                          │
│    ├─► getCurrentDirectory()                                │
│    │   └─► Навигация по currentPath в catalogData           │
│    ├─► renderBreadcrumbs()                                  │
│    ├─► renderDirectoryItem() (для каждой директории)       │
│    ├─► renderArticleItem() (для каждой статьи)             │
│    └─► attachEventListeners()                               │
│        ├─► Клики по директориям → navigateToDirectory()     │
│        └─► Клики по статьям → openArticle()                 │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Отображение каталога в DOM                                │
│    └─► container.innerHTML = html                           │
└─────────────────────────────────────────────────────────────┘
```

### Сценарий 2: Просмотр статьи

```
Пользователь
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 1. Клик по статье в каталоге                                │
│    └─► ArticlesCatalog.openArticle(articleId)              │
│        └─► router.navigate('/article?id=' + articleId)     │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. Загрузка страницы article-view.html                      │
│    └─► initArticleView() вызывается                         │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. getArticleId()                                           │
│    ├─► window.location.search                               │
│    ├─► window.router.currentRoute                           │
│    └─► Возврат articleId                                    │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. loadArticle(articleId)                                    │
│    ├─► fetch('/articles/articles-list.json')                │
│    ├─► findArticle() (рекурсивный поиск по категориям)      │
│    └─► article = найденная статья                           │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. Загрузка Markdown файла                                  │
│    ├─► mdUrl = basePath + article.mdFile                    │
│    ├─► Попытка 1: mdUrl (обычный путь)                      │
│    ├─► Попытка 2: GitHub Raw URL (fallback)                │
│    └─► mdText = await response.text()                       │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. Парсинг frontmatter                                       │
│    ├─► frontmatterMatch = mdText.match(/^---\n...\n---/)     │
│    ├─► yamlText = извлеченный YAML                          │
│    ├─► metadata = парсинг YAML (простой парсер)            │
│    └─► content = mdText без frontmatter                      │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 7. Заполнение метаданных в DOM                              │
│    ├─► article-title.textContent = metadata.title           │
│    ├─► article-author.textContent = metadata.author        │
│    ├─► article-date.textContent = metadata.date            │
│    └─► article-tags.innerHTML = теги                        │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 8. Извлечение ручного содержания (если есть)                │
│    ├─► tocHeaderPattern = /^## 📑 Содержание\n/             │
│    ├─► tocMatch = content.match(tocHeaderPattern)           │
│    ├─► manualToc = извлеченное содержание                  │
│    └─► articleContent = content без содержания              │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 9. simpleMarkdownToHtml(articleContent)                      │
│    ├─► Обработка блоков кода (```)                          │
│    ├─► Обработка LaTeX формул ($$, $)                        │
│    ├─► Обработка формул ([formula])                         │
│    ├─► Обработка заголовков (#)                             │
│    ├─► Обработка таблиц (|)                                 │
│    ├─► Обработка списков (-, *)                             │
│    ├─► Обработка ссылок ([])                                │
│    ├─► Обработка изображений (![])                          │
│    └─► html = результат                                     │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 10. Добавление ID к заголовкам                               │
│     ├─► tempDiv.innerHTML = html                            │
│     ├─► querySelectorAll('h1-h6')                           │
│     ├─► generateHeadingId() для каждого заголовка           │
│     └─► heading.id = сгенерированный ID                     │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 11. Генерация содержания (TOC)                               │
│     ├─► Если manualToc → используем его                    │
│     └─► Иначе → TableOfContents.generate()                  │
│         └─► tocHtml = результат                             │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 12. paginateArticle(html, tocHtml, articleId)                │
│     ├─► Поиск всех h2 заголовков                            │
│     ├─► Разбивка контента по разделам (h2)                  │
│     ├─► Генерация .article-page для каждого раздела         │
│     ├─► Добавление TOC на первую страницу                   │
│     └─► generatePagination() (навигация)                    │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 13. Отображение в DOM                                        │
│     ├─► article-body.innerHTML = paginatedHtml              │
│     └─► Переключение видимости страниц (показ активной)     │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ 14. Инициализация интерактивности                            │
│     ├─► MathJax.typesetPromise() (рендеринг формул)         │
│     ├─► addIdsToHeadings() (гарантия ID)                    │
│     ├─► initTocInteractivity() (клики, скролл)              │
│     ├─► initPagination() (навигация по страницам)           │
│     └─► initScrollButtons() (плавающие кнопки)              │
└─────────────────────────────────────────────────────────────┘
```

---

## Описание компонентов

### ArticlesCatalog

**Назначение:** Отображение каталога статей с навигацией по директориям.

**Основные методы:**

- `init()` - Инициализация каталога, загрузка данных из JSON
- `renderCatalog()` - Рендеринг каталога (директории и статьи)
- `getCurrentDirectory()` - Получение текущей директории на основе пути
- `renderBreadcrumbs()` - Генерация хлебных крошек
- `renderDirectoryItem()` - Рендеринг карточки директории
- `renderArticleItem()` - Рендеринг карточки статьи
- `navigateToDirectory()` - Навигация в директорию
- `openArticle()` - Открытие статьи через роутер

**Поток работы:**

1. Загрузка `articles-list.json`
2. Навигация по структуре категорий через `currentPath`
3. Отображение директорий и статей текущего уровня
4. Обработка кликов для навигации или открытия статьи

### Article Viewer Script

**Назначение:** Загрузка, парсинг и отображение статьи.

**Основные функции:**

- `getArticleId()` - Получение ID статьи из URL (множественные методы)
- `loadArticle()` - Главная функция загрузки статьи
- `simpleMarkdownToHtml()` - Конвертация Markdown в HTML
- `paginateArticle()` - Разбивка статьи на страницы по разделам
- `generatePagination()` - Генерация навигации по страницам
- `generateHeadingId()` - Генерация уникальных ID для заголовков
- `addIdsToHeadings()` - Добавление ID ко всем заголовкам
- `initTocInteractivity()` - Инициализация интерактивности содержания
- `initScrollButtons()` - Инициализация плавающих кнопок навигации

**Особенности:**

- Поддержка множественных источников загрузки (обычный путь, GitHub Raw API)
- Автоматическое извлечение и обработка YAML frontmatter
- Поддержка ручного и автоматического содержания
- Пагинация по разделам (h2)
- Интерактивное содержание с отслеживанием активного раздела

### TableOfContents

**Назначение:** Генерация автоматического содержания из заголовков.

**Основные методы:**

- `generate()` - Главный метод генерации содержания
- `extractHeadings()` - Извлечение заголовков из HTML
- `generateId()` - Генерация уникальных ID для заголовков
- `renderToc()` - Рендеринг HTML содержания
- `initScrollTracking()` - Отслеживание активного раздела при скролле
- `setActiveLink()` - Установка активной ссылки в содержании

**Особенности:**

- Поддержка вложенной структуры (h1-h6)
- Автоматическая генерация ID для заголовков
- Отслеживание активного раздела при прокрутке
- Плавная прокрутка к разделу при клике

---

## Формат данных

### articles-list.json

```json
{
  "categories": [
    {
      "id": "category-id",
      "title": "Название категории",
      "description": "Описание категории",
      "icon": "📁",
      "order": 1,
      "items": [
        {
          "id": "article-id",
          "title": "Название статьи",
          "description": "Описание статьи",
          "mdFile": "articles/article-id/article.md"
        },
        {
          "id": "subcategory-id",
          "title": "Подкатегория",
          "items": [...]
        }
      ]
    }
  ]
}
```

### article.md (YAML frontmatter)

```markdown
---
id: article-id
title: Название статьи
author: Автор
date: 2025-01-01
category: Категория
tags: [тег1, тег2]
description: Описание статьи
readingTime: 10
difficulty: beginner
---

# Заголовок статьи

## 📑 Содержание

- [Раздел 1](#раздел-1)
- [Раздел 2](#раздел-2)

---

## Раздел 1

Текст статьи...
```

---

## Взаимодействие компонентов

```
┌─────────────────────────────────────────────────────────────┐
│                    Пользователь                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 1. Открывает /articles                                       │
│    └─► ArticlesCatalog.init()                                │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. Клик по статье                                           │
│    └─► ArticlesCatalog.openArticle()                         │
│        └─► Router.navigate('/article?id=...')               │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. Загрузка article-view.html                                │
│    └─► Article Viewer Script                                 │
│        ├─► loadArticle()                                     │
│        ├─► simpleMarkdownToHtml()                            │
│        ├─► TableOfContents.generate()                        │
│        ├─► paginateArticle()                                  │
│        └─► MathJax.typesetPromise()                          │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Интерактивность                                          │
│    ├─► initTocInteractivity()                                │
│    │   └─► TableOfContents.initScrollTracking()             │
│    ├─► initPagination()                                      │
│    └─► initScrollButtons()                                   │
└─────────────────────────────────────────────────────────────┘
```

---

## Ключевые особенности

### 1. Множественные источники загрузки

Статьи могут загружаться из нескольких источников:
- Обычный путь (GitHub Pages)
- GitHub Raw API (fallback)
- Локальная разработка

### 2. Поддержка формул

- LaTeX формулы: `$$...$$` (блочные), `$...$` (inline)
- Специальные теги: `[formula]...[/formula]`
- Французские кавычки: `«формула»` (inline)
- Рендеринг через MathJax

### 3. Пагинация

- Автоматическая разбивка по разделам (h2)
- Навигация между страницами
- Сохранение состояния в URL (`?page=N`)

### 4. Интерактивное содержание

- Автоматическая генерация из заголовков
- Поддержка ручного содержания из Markdown
- Отслеживание активного раздела при скролле
- Плавная прокрутка к разделу

### 5. Адаптивность

- Поддержка desktop и mobile
- Плавающие кнопки навигации
- Адаптивная пагинация

---

## Расширение функциональности

### Добавление нового типа блока

1. Добавить обработку в `simpleMarkdownToHtml()`
2. Добавить CSS стили
3. Обновить документацию

### Добавление новых метаданных

1. Добавить поле в YAML frontmatter
2. Обновить парсер frontmatter
3. Использовать в рендеринге

### Кастомизация пагинации

1. Изменить логику в `paginateArticle()`
2. Настроить критерии разбивки (например, по количеству символов)
3. Обновить `generatePagination()`

---

## Заключение

Модуль просмотрщика статей представляет собой комплексную систему с четкой иерархией компонентов, разделением ответственности и поддержкой множества функций. Архитектура позволяет легко расширять функциональность и адаптировать под различные потребности.

---

**Дата создания:** 2025-01-01  
**Версия:** 1.0.0  
**Автор:** AI Assistant
