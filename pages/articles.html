<!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä ?id –î–û –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ -->
<script>
(function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä ?id —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const urlParams = new URLSearchParams(window.location.search);
    const articleId = urlParams.get('id');
    
    if (articleId) {
        // –ï—Å–ª–∏ –µ—Å—Ç—å articleId, —Å—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∫–∞–∑ README.md –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const header = document.querySelector('.page-header');
            const list = document.getElementById('articles-list');
            const viewer = document.getElementById('article-viewer');
            
            if (header) header.style.display = 'none';
            if (list) list.style.display = 'none';
            if (viewer) {
                viewer.style.display = 'block';
                viewer.innerHTML = `
                    <div class="loading-indicator">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—å–∏...</p>
                    </div>
                `;
            }
        });
    }
})();
</script>

<div class="container" style="padding: 2rem 1rem;">
    <!-- Page Header -->
    <header class="page-header" style="text-align: center; margin-bottom: 3rem;">
        <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">üìö –ù–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h1>
        <p style="font-size: 1.2rem; color: var(--text-secondary); max-width: 700px; margin: 0 auto;">
            –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–µ–π –ø–æ –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–µ, –≤–∞–∫—É—É–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –∏ –ø–µ—Ä–µ–¥–æ–≤—ã–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞—É–∫–∏
        </p>
    </header>

    <!-- Articles List (initially visible) -->
    <div id="articles-list">
        <div class="loading-indicator">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–µ–π...</p>
        </div>
    </div>

    <!-- Article Viewer (initially hidden) -->
    <div id="article-viewer" style="display: none;">
        <!-- Article content will be dynamically loaded here -->
    </div>
</div>

<!-- Styles for Articles Page -->
<style>
/* Loading Indicator */
.loading-indicator {
    text-align: center;
    padding: 4rem 1rem;
}

.spinner {
    width: 50px;
    height: 50px;
    margin: 0 auto 1rem;
    border: 4px solid var(--border-color);
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Articles Grid */
.articles-grid {
    max-width: 1200px;
    margin: 0 auto;
}

.category-section {
    margin-bottom: 3rem;
}

.category-section.category-nested {
    margin-bottom: 2rem;
    margin-left: 2rem;
    padding-left: 1.5rem;
    border-left: 2px solid var(--border-color);
}

.category-header {
    cursor: pointer;
    user-select: none;
    transition: all 0.2s ease;
}

.category-header:hover {
    opacity: 0.8;
}

.category-title {
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.category-section[data-level="1"] .category-title {
    font-size: 1.5rem;
}

.category-section[data-level="2"] .category-title {
    font-size: 1.25rem;
}

.category-icon {
    font-size: 1.2em;
}

.category-toggle {
    font-size: 0.8em;
    margin-left: auto;
    transition: transform 0.2s ease;
    color: var(--text-secondary);
}

.category-description {
    font-size: 0.95rem;
    color: var(--text-secondary);
    margin-top: -1rem;
    margin-bottom: 1rem;
    font-style: italic;
}

.category-content {
    margin-top: 1rem;
    transition: all 0.3s ease;
}

.articles-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

/* Article Card */
.article-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.article-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-color, #3b82f6);
}

.article-card-header {
    margin-bottom: 1rem;
}

.article-card-title {
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    line-height: 1.4;
}

.article-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.article-card-body {
    margin-bottom: 1rem;
}

.article-card-description {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.6;
}

.article-card-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

.article-card-footer span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* Back Button */
.back-to-list-btn {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
    margin-bottom: 2rem;
    transition: all 0.2s ease;
}

.back-to-list-btn:hover {
    background: var(--primary-color, #3b82f6);
    color: white;
    border-color: var(--primary-color, #3b82f6);
}

/* No Articles Message */
.no-articles {
    text-align: center;
    padding: 4rem 1rem;
    color: var(--text-secondary);
}

.no-articles p {
    font-size: 1.2rem;
}

/* Error Message */
.article-error {
    text-align: center;
    padding: 4rem 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.article-error h2 {
    color: #dc2626;
    margin-bottom: 1rem;
}

.article-error p {
    color: var(--text-secondary);
    margin-bottom: 2rem;
}

/* Responsive */
@media (max-width: 768px) {
    .articles-cards {
        grid-template-columns: 1fr;
    }
    
    .page-header h1 {
        font-size: 2rem;
    }
    
    .page-header p {
        font-size: 1rem;
    }
}

/* Dark Theme Support */
@media (prefers-color-scheme: dark) {
    .article-card {
        background: var(--bg-secondary, #1e293b);
        border-color: var(--border-color, #334155);
    }
    
    .article-card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
}
</style>

<!-- Initialize Article Viewer -->
<script>
(function() {
    console.log('Articles page script starting...');
    
    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    async function initArticleViewer(retries = 5) {
        console.log(`Attempting to initialize ArticleViewer (${retries} retries left)...`);
        
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ ArticleViewer –¥–æ—Å—Ç—É–ø–µ–Ω
            if (typeof ArticleViewer === 'undefined') {
                if (retries > 0) {
                    console.log('ArticleViewer not ready, retrying in 200ms...');
                    setTimeout(() => initArticleViewer(retries - 1), 200);
                    return;
                }
                throw new Error('ArticleViewer class not loaded. Check script order in index.html');
            }
            console.log('‚úì ArticleViewer class found');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ ArticleParser –¥–æ—Å—Ç—É–ø–µ–Ω
            if (typeof ArticleParser === 'undefined') {
                if (retries > 0) {
                    console.log('ArticleParser not ready, retrying in 200ms...');
                    setTimeout(() => initArticleViewer(retries - 1), 200);
                    return;
                }
                throw new Error('ArticleParser class not loaded. Check script order in index.html');
            }
            console.log('‚úì ArticleParser class found');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
            const listContainer = document.getElementById('articles-list');
            if (!listContainer) {
                console.warn('articles-list container not found, waiting...');
                if (retries > 0) {
                    setTimeout(() => initArticleViewer(retries - 1), 200);
                    return;
                }
                throw new Error('articles-list container not found');
            }
            console.log('‚úì Containers found');
            
            // –ü–æ–ª—É—á–∞–µ–º basePath –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞
            const basePath = window.router?.basePath || '';
            console.log('ArticleViewer: basePath =', basePath);
            
            // –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä ArticleViewer
            console.log('Creating ArticleViewer instance...');
            const viewer = new ArticleViewer({
                basePath: basePath,
                listContainerId: 'articles-list',
                viewerContainerId: 'article-viewer',
                configPath: '/data/config.json'
            });
            
            console.log('‚úì ArticleViewer instance created');
            
            // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            window.articleViewer = viewer;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
            console.log('Initializing ArticleViewer...');
            await viewer.init();
            console.log('‚úì ArticleViewer initialized successfully');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            window.addEventListener('popstate', (event) => {
                const urlParams = new URLSearchParams(window.location.search);
                const articleId = urlParams.get('id');
                
                if (articleId) {
                    viewer.viewArticle(articleId);
                } else {
                    viewer.backToList();
                }
            });
            
            console.log('‚úì Articles page initialization complete');
        } catch (error) {
            console.error('‚úó Error initializing ArticleViewer:', error);
            console.error('Error stack:', error.stack);
            const listContainer = document.getElementById('articles-list');
            if (listContainer) {
                listContainer.innerHTML = `
                    <div class="article-error">
                        <h2>‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
                        </p>
                    </div>
                `;
            }
        }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º DOMContentLoaded –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ DOM –≥–æ—Ç–æ–≤
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => initArticleViewer(), 50);
        });
    } else {
        // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        setTimeout(() => initArticleViewer(), 50);
    }
})();
</script>
