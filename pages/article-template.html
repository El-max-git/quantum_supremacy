<div class="article-wrapper">
    <!-- Table of Contents -->
    <aside class="article-toc-sidebar" id="article-toc-sidebar">
        <div class="toc-sticky">
            <h3 class="toc-title">Содержание</h3>
            <div id="article-toc">
                <!-- TOC will be generated here -->
            </div>
        </div>
    </aside>
    
    <!-- Article Content -->
    <article class="article-content" id="article-content">
        <!-- Article Header -->
        <header class="article-header">
            <div class="article-category" id="article-category"></div>
            <h1 class="article-title" id="article-title">Загрузка...</h1>
            <div class="article-meta">
                <span class="article-author" id="article-author"></span>
                <span class="article-date" id="article-date"></span>
                <span class="article-reading-time" id="article-reading-time"></span>
            </div>
            <div class="article-tags" id="article-tags"></div>
        </header>
        
        <!-- Article Body -->
        <div class="article-body" id="article-body">
            <!-- Parsed markdown content will be injected here -->
        </div>
        
        <!-- Article Footer -->
        <footer class="article-footer">
            <div class="article-navigation">
                <a href="#" class="article-nav-button prev-article" id="prev-article" data-link style="display: none;">
                    <span class="nav-arrow">←</span>
                    <span class="nav-label">Предыдущая</span>
                </a>
                <a href="#" class="article-nav-button next-article" id="next-article" data-link style="display: none;">
                    <span class="nav-label">Следующая</span>
                    <span class="nav-arrow">→</span>
                </a>
            </div>
        </footer>
    </article>
</div>

<script>
// Загрузка и отображение статьи
(async function() {
    // Получаем ID статьи из URL
    const pathParts = window.location.pathname.split('/');
    const articleId = pathParts[pathParts.length - 1];
    
    try {
        // Загружаем конфигурацию
        const config = await fetch(`${window.router?.basePath || ''}/data/config.json`).then(r => r.json());
        
        // Находим статью
        const article = config.articles?.find(a => a.id === articleId);
        
        if (!article) {
            throw new Error('Article not found');
        }
        
        // Загружаем markdown файл
        const mdText = await fetch(`${window.router?.basePath || ''}/${article.mdFile}`).then(r => r.text());
        
        // ArticleParser удален - парсинг markdown отключен
        // TODO: Реализовать альтернативный способ парсинга markdown или использовать предкомпилированный HTML
        
        // Заполняем метаданные из config.json (frontmatter больше не парсится)
        document.getElementById('article-title').textContent = article.title;
        document.getElementById('article-category').textContent = article.category || 'Статья';
        document.getElementById('article-author').textContent = article.author || '';
        document.getElementById('article-date').textContent = article.date || '';
        
        const readingTime = article.readingTime;
        if (readingTime) {
            document.getElementById('article-reading-time').textContent = `${readingTime} мин чтения`;
        }
        
        // Теги из config
        const tags = article.tags;
        if (tags && tags.length) {
            const tagsHtml = tags.map(tag => `<span class="tag">${tag}</span>`).join('');
            document.getElementById('article-tags').innerHTML = tagsHtml;
        }
        
        // Вставляем содержимое (markdown не парсится)
        // TODO: Использовать предкомпилированный HTML или альтернативный парсер
        document.getElementById('article-body').innerHTML = `
            <div class="article-error">
                <h2>⚠️ Парсер статей отключен</h2>
                <p>ArticleParser был удален. Необходимо реализовать альтернативный способ отображения статей.</p>
            </div>
        `;
        
        // Генерация содержания отключена (требует HTML контента)
        // const toc = new TableOfContents({ minHeadings: 2 });
        // const tocHtml = toc.generate(document.getElementById('article-body'));
        // document.getElementById('article-toc').innerHTML = tocHtml;
        // toc.initScrollTracking();
        
        // Навигация по статьям
        const currentIndex = config.articles.findIndex(a => a.id === articleId);
        if (currentIndex > 0) {
            const prevArticle = config.articles[currentIndex - 1];
            const prevLink = document.getElementById('prev-article');
            prevLink.href = prevArticle.path;
            prevLink.querySelector('.nav-label').textContent = prevArticle.title;
            prevLink.style.display = 'flex';
        }
        if (currentIndex < config.articles.length - 1) {
            const nextArticle = config.articles[currentIndex + 1];
            const nextLink = document.getElementById('next-article');
            nextLink.href = nextArticle.path;
            nextLink.querySelector('.nav-label').textContent = nextArticle.title;
            nextLink.style.display = 'flex';
        }
        
    } catch (error) {
        console.error('Error loading article:', error);
        document.getElementById('article-body').innerHTML = `
            <div class="article-error">
                <h2>❌ Ошибка загрузки статьи</h2>
                <p>${error.message}</p>
            </div>
        `;
    }
})();
</script>
